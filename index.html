<!--  Dominic Balassone
      First attempt at a socket.io chatroom
  -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Be social">
    <meta name="author" content="Dominic Balassone">
    <title>chat.io</title>
    <!-- Material Design fonts -->
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/icon?family=Material+Icons">

    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

    <!-- Bootstrap Material Design -->
    <link rel="stylesheet" type="text/css" href="/scripts/css/bootstrap-material-design.css">
    <link rel="stylesheet" type="text/css" href="/scripts/css/ripples.min.css">

    <!-- Custom CSS -->
    <style type="text/css">
      #successtext {
        float: left;
        padding-left: 18px;
        padding-bottom: 10px;
        font-weight: bold;
      }
              
      #inputMessage{
        position: fixed;
        bottom: 0;
        width: 100%;
        padding-bottom: 18px;
      }
    </style>
  </head>

  <body>
    <!-- NavBar -->
    <div class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="javascript:void(0)">chat.io</a>
        </div>
        <div class="navbar-collapse collapse navbar-responsive-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="javascript:void(0)">Active</a></li>
            <li><a href="javascript:void(0)">Link</a></li>
            <li class="dropdown">
              <a href="http://fezvrasta.github.io/bootstrap-material-design/bootstrap-elements.html" data-target="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown
                <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="javascript:void(0)">Action</a></li>
                <li><a href="javascript:void(0)">Another action</a></li>
                <li><a href="javascript:void(0)">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Dropdown header</li>
                <li><a href="javascript:void(0)">Separated link</a></li>
                <li><a href="javascript:void(0)">One more separated link</a></li>
              </ul>
            </li>
          </ul>
          <form class="navbar-form navbar-left">
            <div class="form-group">
              <input type="text" class="form-control col-sm-8" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="javascript:void(0)">Link</a></li>
            <li class="dropdown">
              <a href="http://fezvrasta.github.io/bootstrap-material-design/bootstrap-elements.html" data-target="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown
                <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="javascript:void(0)">Action</a></li>
                <li><a href="javascript:void(0)">Another action</a></li>
                <li><a href="javascript:void(0)">Something else here</a></li>
                <li class="divider"></li>
                <li><a href="javascript:void(0)">Separated link</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Main View -->
    <div class="chat">
      <div class="chatArea">
        <ul class="messages"></ul>
      </div>
      <div id="inputMessage" class="form-group label-floating">
        <label for="555" class="control-label">Give your input...</label>
        <input type="text" class="form-control" id="555">

        <p class="help-block">Have fun chatting!</p>
      </div>
    </div>

    <!-- Trigger the modal with a button
    <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button>
    --->
    <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Welcome to chat.io!</h2>
          </div>
          <div class="modal-body">
            <h4>Create a username and password OR login with your already existing credentials.</h4>
            <form>
              <fieldset class="form-group">
                <input type="email" class="form-control" id="InputEmail" placeholder="Username">
              </fieldset>
              <fieldset class="form-group">
                <input type="password" class="form-control" id="InputPassword" placeholder="Password">
              </fieldset>
          </div>
          <div class="modal-footer">
            <div id='successtext'></div>
            <button type="button" class="btn btn-warning" id='loginbut' type="submit">Login</button>
          </div>
        </div>
      </div>
    </div>






    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <!-- Material -->
    <script type="text/javascript" src="/scripts/js/material.min.js"></script>
    <script type="text/javascript" src="/scripts/js/ripples.min.js"></script>
    <!-- My JS -->
    <script>
    //Socket stuff
    var socket = io.connect(window.location.hostname);

    socket.on('login', function(success){
      if(success[0]){
        document.getElementById('successtext').innerHTML = '<h4>Login Successful!'
        document.getElementById('successtext').style.color = 'lightgreen'
        setTimeout(function(){
          $('#myModal').modal('hide');
          $('.chat').fadeIn(2000);
          $('.topinfo').css({'display':'inline-block',
                             'opacity': 1});
        },1500)
      }else{
        if(success[1] == 'wrongpass'){
          document.getElementById('successtext').innerHTML = '<h4>Login Unauthorized!'
          document.getElementById('successtext').style.color = 'red'
        }else if(success[1] == 'tooshort'){
          document.getElementById('successtext').innerHTML = '<h4>Username and Password must contain at least 2 characters!'
          document.getElementById('successtext').style.color = 'red'
        }
      }
    });
  
    // custom modal show behavior
    $('#myModal').on('show.bs.modal', function () {
         $(this).find('.modal-body').css({
                width:'auto', //probably not needed
                height:'auto', //probably not needed 
                'max-height':'100%'
         });
    });
    //on page load
    $(window).load(function(){
      $('#myModal').modal('show');
    })
    //on ready
    $(document).ready(function(){
      $.material.init()
      $('.dropdown-toggle').dropdown();

    });

    //try to login via socket when clicking on login button
    $('#loginbut').on('click', function(event) {
      socket.emit('login', [$('#InputEmail').val(), $('#InputPassword').val()])
      document.getElementById('successtext').innerHTML = 'Contacting Server...'
      document.getElementById('successtext').style.color = 'yellow'
    });;

    //set login modal to be unexitable
    $('#myModal').modal({
      backdrop: 'static',
      keyboard: false
    });

    //set enter to be the submit key for login modal
    $("input").keypress(function(event) {
      if($('#myModal').is(":visible")){
        if (event.which == 13) {
          socket.emit('login', [$('#InputEmail').val(), $('#InputPassword').val()])
        }
      }
    });
    </script>
  </body>
</html>